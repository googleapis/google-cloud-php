{"id":"datastore\/transaction","type":"","title":"Google\\Cloud\\Datastore\\Transaction","name":"Transaction","description":"<p>Represents a Transaction<\/p>\n<p>A transaction is a set of Datastore operations on one or more entities. Each\ntransaction is guaranteed to be atomic, which means that transactions are\nnever partially applied. Either all of the operations in the transaction are\napplied, or none of them are applied.<\/p>\n<p>It is highly recommended that users read and understand the underlying\nconcepts in <a href=\"https:\/\/cloud.google.com\/datastore\/docs\/concepts\/transactions\">Transactions<\/a>\nbefore beginning.<\/p>\n<p>Mutations (i.e. insert, update and delete) are not executed immediately.\nCalls to those methods (and their batch equivalents) will enqueue a new\nmutation. Calling <a data-custom-type=\"datastore\/transaction\" data-method=\"commit\">Google\\Cloud\\Datastore\\Transaction::commit()<\/a> will\nexecute all the mutationsin the order they were enqueued, and end the\ntransaction.<\/p>\n<p>Lookups and queries can be run in a transaction, so long as they are run\nprior to committing or rolling back the transaction.<\/p>\n<p>Transactions are an <strong>optional<\/strong> feature of Google Cloud Datastore. Queries,\nlookups and mutations can be executed outside of a Transaction from\n<a data-custom-type=\"datastore\/datastoreclient\">Google\\Cloud\\Datastore\\DatastoreClient<\/a>.<\/p>","examples":[{"caption":"","code":"use Google\\Cloud\\ServiceBuilder;\n\n$cloud = new ServiceBuilder();\n\n$datastore = $cloud->datastore();\n\n$transaction = $datastore->transaction();"}],"resources":[{"title":"Transactions","link":"https:\/\/cloud.google.com\/datastore\/docs\/concepts\/transactions"}],"methods":[{"id":"__construct","type":"constructor","name":"__construct","source":"#L89","description":"<p>Create a Transaction<\/p>","examples":[],"resources":[],"params":[{"name":"operation","description":"<p>Class that handles shared API interaction.<\/p>","types":["<a data-custom-type=\"datastore\/operation\">Google\\Cloud\\Datastore\\Operation<\/a>"],"optional":false,"nullable":null},{"name":"projectId","description":"<p>The Google Cloud Platform project ID.<\/p>","types":["string"],"optional":false,"nullable":null},{"name":"transactionId","description":"<p>The transaction to run mutations in.<\/p>","types":["string"],"optional":false,"nullable":null}],"exceptions":[],"returns":[]},{"id":"insert","type":"instance","name":"insert","source":"#L117","description":"<p>Insert an entity<\/p>\n<p>No service requests are run when this method is called.\nUse <a data-custom-type=\"datastore\/transaction\" data-method=\"commit\">Google\\Cloud\\Datastore\\Transaction::commit()<\/a> to commit changes.<\/p>","examples":[{"caption":"","code":"$key = $datastore->key('Person', 'Bob');\n$entity = $datastore->entity($key, ['firstName' => 'Bob']);\n\n$transaction->insert($entity);\n$transaction->commit();"}],"resources":[],"params":[{"name":"entity","description":"<p>The entity to insert.<\/p>","types":["<a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"datastore\/transaction\">Google\\Cloud\\Datastore\\Transaction<\/a>"],"description":""}]},{"id":"insertBatch","type":"instance","name":"insertBatch","source":"#L142","description":"<p>Insert multiple entities<\/p>\n<p>No service requests are run when this method is called.\nUse <a data-custom-type=\"datastore\/transaction\" data-method=\"commit\">Google\\Cloud\\Datastore\\Transaction::commit()<\/a> to commit changes.<\/p>","examples":[{"caption":"","code":"$entities = [\n    $datastore->entity('Person', ['firstName' => 'Bob']),\n    $datastore->entity('Person', ['firstName' => 'John'])\n];\n\n$transaction->insertBatch($entities);\n$transaction->commit();"}],"resources":[],"params":[{"name":"entities","description":"<p>The entities to insert.<\/p>","types":["<a data-custom-type=\"datastore\/entity[]\">Google\\Cloud\\Datastore\\Entity[]<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"datastore\/transaction\">Google\\Cloud\\Datastore\\Transaction<\/a>"],"description":""}]},{"id":"update","type":"instance","name":"update","source":"#L179","description":"<p>Update an entity<\/p>\n<p>No service requests are run when this method is called.\nUse <a data-custom-type=\"datastore\/transaction\" data-method=\"commit\">Google\\Cloud\\Datastore\\Transaction::commit()<\/a> to commit changes.<\/p>","examples":[{"caption":"","code":"$entity['firstName'] = 'Bob';\n\n$transaction->update($entity);\n$transaction->commit();"}],"resources":[],"params":[{"name":"entity","description":"<p>The entity to update.<\/p>","types":["<a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>"],"optional":false,"nullable":null},{"name":"options","description":"<p>Configuration Options<\/p>","types":["array"],"optional":true,"nullable":null},{"name":"options.allowOverwrite","description":"<p>Entities must be updated as an entire resource. Patch operations are not supported. Because entities can be created manually, or obtained by a lookup or query, it is possible to accidentally overwrite an existing record with a new one when manually creating an entity. To provide additional safety, this flag must be set to <code>true<\/code> in order to update a record when the entity provided was not obtained through a lookup or query. <strong>Defaults to<\/strong> <code>false<\/code>.<\/p>","types":["bool"],"optional":null,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"datastore\/transaction\">Google\\Cloud\\Datastore\\Transaction<\/a>"],"description":""}]},{"id":"updateBatch","type":"instance","name":"updateBatch","source":"#L218","description":"<p>Update multiple entities<\/p>\n<p>No service requests are run when this method is called.\nUse <a data-custom-type=\"datastore\/transaction\" data-method=\"commit\">Google\\Cloud\\Datastore\\Transaction::commit()<\/a> to commit changes.<\/p>","examples":[{"caption":"","code":"$entities[0]['firstName'] = 'Bob';\n$entities[1]['firstName'] = 'John';\n\n$transaction->updateBatch($entities);\n$transaction->commit();"}],"resources":[],"params":[{"name":"entities","description":"<p>The entities to update.<\/p>","types":["<a data-custom-type=\"datastore\/entity[]\">Google\\Cloud\\Datastore\\Entity[]<\/a>"],"optional":false,"nullable":null},{"name":"options","description":"<p>Configuration Options<\/p>","types":["array"],"optional":true,"nullable":null},{"name":"options.allowOverwrite","description":"<p>Entities must be updated as an entire resource. Patch operations are not supported. Because entities can be created manually, or obtained by a lookup or query, it is possible to accidentally overwrite an existing record with a new one when manually creating an entity. To provide additional safety, this flag must be set to <code>true<\/code> in order to update a record when the entity provided was not obtained through a lookup or query. <strong>Defaults to<\/strong> <code>false<\/code>.<\/p>","types":["bool"],"optional":null,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"datastore\/transaction\">Google\\Cloud\\Datastore\\Transaction<\/a>"],"description":""}]},{"id":"upsert","type":"instance","name":"upsert","source":"#L251","description":"<p>Upsert an entity<\/p>\n<p>No service requests are run when this method is called.\nUse <a data-custom-type=\"datastore\/transaction\" data-method=\"commit\">Google\\Cloud\\Datastore\\Transaction::commit()<\/a> to commit changes.<\/p>\n<p>Upsert will create a record if one does not already exist, or overwrite\nexisting record if one already exists.<\/p>","examples":[{"caption":"","code":"$key = $datastore->key('Person', 'Bob');\n$entity = $datastore->entity($key, ['firstName' => 'Bob']);\n\n$transaction->upsert($entity);\n$transaction->commit();"}],"resources":[],"params":[{"name":"entity","description":"<p>The entity to upsert.<\/p>","types":["<a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"datastore\/transaction\">Google\\Cloud\\Datastore\\Transaction<\/a>"],"description":""}]},{"id":"upsertBatch","type":"instance","name":"upsertBatch","source":"#L284","description":"<p>Upsert multiple entities<\/p>\n<p>No service requests are run when this method is called.\nUse <a data-custom-type=\"datastore\/transaction\" data-method=\"commit\">Google\\Cloud\\Datastore\\Transaction::commit()<\/a> to commit changes.<\/p>\n<p>Upsert will create a record if one does not already exist, or overwrite\nexisting record if one already exists.<\/p>","examples":[{"caption":"","code":"$keys = [\n    $datastore->key('Person', 'Bob'),\n    $datastore->key('Person', 'John')\n];\n\n$entities = [\n    $datastore->entity($key[0], ['firstName' => 'Bob']),\n    $datastore->entity($key[1], ['firstName' => 'John'])\n];\n\n$transaction->upsertBatch($entities);\n$transaction->commit();"}],"resources":[],"params":[{"name":"entities","description":"<p>The entities to upsert.<\/p>","types":["<a data-custom-type=\"datastore\/entity[]\">Google\\Cloud\\Datastore\\Entity[]<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"datastore\/transaction\">Google\\Cloud\\Datastore\\Transaction<\/a>"],"description":""}]},{"id":"delete","type":"instance","name":"delete","source":"#L308","description":"<p>Delete a record<\/p>\n<p>No service requests are run when this method is called.\nUse <a data-custom-type=\"datastore\/transaction\" data-method=\"commit\">Google\\Cloud\\Datastore\\Transaction::commit()<\/a> to commit changes.<\/p>","examples":[{"caption":"","code":"$key = $datastore->key('Person', 'Bob');\n\n$transaction->delete($key);\n$transaction->commit();"}],"resources":[],"params":[{"name":"key","description":"<p>The key to delete<\/p>","types":["<a data-custom-type=\"datastore\/key\">Google\\Cloud\\Datastore\\Key<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"datastore\/transaction\">Google\\Cloud\\Datastore\\Transaction<\/a>"],"description":""}]},{"id":"deleteBatch","type":"instance","name":"deleteBatch","source":"#L333","description":"<p>Delete multiple records<\/p>\n<p>No service requests are run when this method is called.\nUse <a data-custom-type=\"datastore\/transaction\" data-method=\"commit\">Google\\Cloud\\Datastore\\Transaction::commit()<\/a> to commit changes.<\/p>","examples":[{"caption":"","code":"$keys = [\n    $datastore->key('Person', 'Bob'),\n    $datastore->key('Person', 'John')\n];\n\n$transaction->deleteBatch($keys);\n$transaction->commit();"}],"resources":[],"params":[{"name":"keys","description":"<p>The keys to delete.<\/p>","types":["<a data-custom-type=\"datastore\/key[]\">Google\\Cloud\\Datastore\\Key[]<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"datastore\/transaction\">Google\\Cloud\\Datastore\\Transaction<\/a>"],"description":""}]},{"id":"lookup","type":"instance","name":"lookup","source":"#L363","description":"<p>Retrieve an entity from the datastore inside a transaction<\/p>","examples":[{"caption":"","code":"$key = $datastore->key('Person', 'Bob');\n\n$entity = $transaction->lookup($key);\nif (!is_null($entity)) {\n    echo $entity['firstName']; \/\/ 'Bob'\n}"}],"resources":[],"params":[{"name":"key","description":"<p>$key The identifier to use to locate a desired entity.<\/p>","types":["<a data-custom-type=\"datastore\/key\">Google\\Cloud\\Datastore\\Key<\/a>"],"optional":false,"nullable":null},{"name":"options","description":"<p>Configuration Options<\/p>","types":["array"],"optional":true,"nullable":null},{"name":"options.className","description":"<p>The name of the class to return results as. Must be a subclass of <a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>. If not set, <a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a> will be used.<\/p>","types":["string"],"optional":null,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>","null"],"description":""}]},{"id":"lookupBatch","type":"instance","name":"lookupBatch","source":"#L405","description":"<p>Get multiple entities inside a transaction<\/p>","examples":[{"caption":"","code":"$keys = [\n    $datastore->key('Person', 'Bob'),\n    $datastore->key('Person', 'John')\n];\n\n$entities = $transaction->lookup($keys);\n\nforeach ($entities['found'] as $entity) {\n    echo $entity['firstName'];\n}"}],"resources":[],"params":[{"name":"key","description":"<p>The identifiers to look up.<\/p>","types":["<a data-custom-type=\"datastore\/key[]\">Google\\Cloud\\Datastore\\Key[]<\/a>"],"optional":false,"nullable":null},{"name":"options","description":"<p>Configuration Options<\/p>","types":["array"],"optional":true,"nullable":null},{"name":"options.className","description":"<p>If a string, the name of the class to return results as. Must be a subclass of <a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>. If not set, <a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a> will be used. If an array is given, it must be an associative array, where the key is a Kind and the value is the name of a subclass of <a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>.<\/p>","types":["string","array"],"optional":null,"nullable":null}],"exceptions":[],"returns":[{"types":["array"],"description":"<p>Returns an array with keys [<code>found<\/code>, <code>missing<\/code>, and <code>deferred<\/code>].\nMembers of <code>found<\/code> will be instance of\n<a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>. Members of <code>missing<\/code> and\n<code>deferred<\/code> will be instance of <a data-custom-type=\"datastore\/key\">Google\\Cloud\\Datastore\\Key<\/a>.<\/p>"}]},{"id":"runQuery","type":"instance","name":"runQuery","source":"#L434","description":"<p>Run a query and return entities inside a Transaction<\/p>","examples":[{"caption":"","code":"$result = $transaction->runQuery($query);\n\nforeach ($result as $entity) {\n    echo $entity['firstName'];\n}"}],"resources":[],"params":[{"name":"query","description":"<p>The query object.<\/p>","types":["<a data-custom-type=\"datastore\/query\/queryinterface\">Google\\Cloud\\Datastore\\Query\\QueryInterface<\/a>"],"optional":false,"nullable":null},{"name":"options","description":"<p>Configuration Options<\/p>","types":["array"],"optional":true,"nullable":null},{"name":"options.className","description":"<p>The name of the class to return results as. Must be a subclass of <a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>. If not set, <a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a> will be used.<\/p>","types":["string"],"optional":null,"nullable":null}],"exceptions":[],"returns":[{"types":["Generator&lt;<a data-custom-type=\"datastore\/entity\">Google\\Cloud\\Datastore\\Entity<\/a>&gt;"],"description":""}]},{"id":"commit","type":"instance","name":"commit","source":"#L455","description":"<p>Commit all mutations<\/p>\n<p>Calling this method will end the operation (and close the transaction,\nif one is specified).<\/p>","examples":[{"caption":"","code":"$transaction->commit()"}],"resources":[],"params":[{"name":"options","description":"<p>Configuration Options.<\/p>","types":["array"],"optional":true,"nullable":null}],"exceptions":[],"returns":[{"types":["array"],"description":"<p><a href=\"https:\/\/cloud.google.com\/datastore\/reference\/rest\/v1\/projects\/commit#response-body\">Response Body<\/a><\/p>"}]},{"id":"rollback","type":"instance","name":"rollback","source":"#L472","description":"<p>Roll back a Transaction<\/p>","examples":[{"caption":"","code":"$transaction->rollback();"}],"resources":[],"params":[],"exceptions":[],"returns":[{"types":["void"],"description":""}]}]}