{"id":"core\/iam\/policybuilder","type":"","title":"Google\\Cloud\\Core\\Iam\\PolicyBuilder","name":"PolicyBuilder","description":"<p>Helper class for creating valid IAM policies<\/p>","examples":[{"caption":"","code":"use Google\\Cloud\\Core\\Iam\\PolicyBuilder;\n\n$builder = new PolicyBuilder();\n$builder->addBinding('roles\/admin', [ 'user:admin@domain.com' ]);\n$result = $builder->result();"}],"resources":[],"methods":[{"id":"__construct","type":"constructor","name":"__construct","source":"Core\/src\/Iam\/PolicyBuilder.php#L90","description":"<p>Create a PolicyBuilder.<\/p>\n<p>To use conditions in the bindings, the version of the policy must be set\nto 3.<\/p>","examples":[],"resources":[{"title":"Policy versioning","link":"https:\/\/cloud.google.com\/iam\/docs\/policies#versions"},{"title":"Using Cloud IAM Conditions on buckets\n\nExample:\n```\n$policy = [\n    'etag' => 'AgIc==',\n    'version' => 3,\n    'bindings' => [\n        [\n            'role' => 'roles\/admin',\n            'members' => [\n                'user:admin@domain.com',\n                'user2:admin@domain.com'\n            ],\n            'condition' => [\n                'title' => 'match-prefix',\n                'description' => 'Applies to objects matching a prefix',\n                'expression' =>\n                    'resource.name.startsWith(\"projects\/_\/buckets\/bucket-name\/objects\/prefix-a-\")'\n            ]\n        ]\n    ],\n];\n\n$builder = new PolicyBuilder($policy);\n```","link":"https:\/\/cloud-dot-devsite.googleplex.com\/storage\/docs\/access-control\/using-iam-permissions#conditions-iam"}],"params":[{"name":"policy","description":"<p>A policy array<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":false,"nullable":null}],"exceptions":[{"type":"\\InvalidArgumentException","description":""}],"returns":[]},{"id":"setBindings","type":"instance","name":"setBindings","source":"Core\/src\/Iam\/PolicyBuilder.php#L130","description":"<p>Override all stored bindings on the policy.<\/p>","examples":[{"caption":"","code":"$builder->setBindings([\n    [\n        'role' => 'roles\/admin',\n        'members' => [\n            'user:admin@domain.com'\n        ],\n        'condition' => [\n            'expression' =>\n                'request.time < timestamp(\"2020-07-01T00:00:00.000Z\")'\n        ]\n    ]\n]);"}],"resources":[],"params":[{"name":"bindings","description":"<p>An array of bindings<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":true,"nullable":null}],"exceptions":[{"type":"\\InvalidArgumentException","description":""}],"returns":[{"types":["<a data-custom-type=\"cloud-core\/v1.39.0\/core\/iam\/policybuilder\">Google\\Cloud\\Core\\Iam\\PolicyBuilder<\/a>"],"description":""}]},{"id":"addBinding","type":"instance","name":"addBinding","source":"Core\/src\/Iam\/PolicyBuilder.php#L158","description":"<p>Add a new binding to the policy.<\/p>\n<p>This method will fail with an InvalidOpereationException if it is\ncalled on a Policy with a version greater than 1 as that indicates\na more complicated policy than this method is prepared to handle.\nChanges to such policies must be made manually by the setBindings()\nmethod.<\/p>","examples":[{"caption":"","code":"$builder->addBinding('roles\/admin', [ 'user:admin@domain.com' ]);"}],"resources":[],"params":[{"name":"role","description":"<p>A valid role for the service<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":false,"nullable":null},{"name":"members","description":"<p>An array of members to assign to the binding<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":false,"nullable":null}],"exceptions":[{"type":"\\InvalidArgumentException","description":""},{"type":"\\BadMethodCallException","description":"if the policy's version is greater than 1."}],"returns":[{"types":["<a data-custom-type=\"cloud-core\/v1.39.0\/core\/iam\/policybuilder\">Google\\Cloud\\Core\\Iam\\PolicyBuilder<\/a>"],"description":""}]},{"id":"removeBinding","type":"instance","name":"removeBinding","source":"Core\/src\/Iam\/PolicyBuilder.php#L200","description":"<p>Remove a binding from the policy.<\/p>\n<p>This method will fail with a BadMethodCallException if it is\ncalled on a Policy with a version greater than 1 as that indicates\na more complicated policy than this method is prepared to handle.\nChanges to such policies must be made manually by the setBindings()\nmethod.<\/p>","examples":[{"caption":"","code":"$builder->setBindings([\n    [\n        'role' => 'roles\/admin',\n        'members' => [\n            'user:admin@domain.com',\n            'user2:admin@domain.com'\n        ]\n    ]\n]);\n$builder->removeBinding('roles\/admin', [ 'user:admin@domain.com' ]);"}],"resources":[],"params":[{"name":"role","description":"<p>A valid role for the service<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":false,"nullable":null},{"name":"members","description":"<p>An array of members to remove from the role<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":false,"nullable":null}],"exceptions":[{"type":"\\InvalidArgumentException","description":""},{"type":"\\BadMethodCallException","description":"if the policy's version is greater than 1."}],"returns":[{"types":["<a data-custom-type=\"cloud-core\/v1.39.0\/core\/iam\/policybuilder\">Google\\Cloud\\Core\\Iam\\PolicyBuilder<\/a>"],"description":""}]},{"id":"setEtag","type":"instance","name":"setEtag","source":"Core\/src\/Iam\/PolicyBuilder.php#L240","description":"<p>Update the etag on the policy.<\/p>","examples":[{"caption":"","code":"$builder->setEtag($oldPolicy['etag']);"}],"resources":[],"params":[{"name":"etag","description":"<p>used for optimistic concurrency control as a way to help prevent simultaneous updates of a\npolicy from overwriting each other. It is strongly suggested that updates to existing policies make use\nof the etag to avoid race conditions.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"cloud-core\/v1.39.0\/core\/iam\/policybuilder\">Google\\Cloud\\Core\\Iam\\PolicyBuilder<\/a>"],"description":""}]},{"id":"setVersion","type":"instance","name":"setVersion","source":"Core\/src\/Iam\/PolicyBuilder.php#L258","description":"<p>Update the version of the policy.<\/p>","examples":[{"caption":"","code":"$builder->setVersion(1);"}],"resources":[],"params":[{"name":"version","description":"<p>Version of the Policy. <strong>Defaults to<\/strong> <code>0<\/code>.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.integer.php\" target=\"_blank\">int<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"cloud-core\/v1.39.0\/core\/iam\/policybuilder\">Google\\Cloud\\Core\\Iam\\PolicyBuilder<\/a>"],"description":""}]},{"id":"result","type":"instance","name":"result","source":"Core\/src\/Iam\/PolicyBuilder.php#L275","description":"<p>Create a policy array with data in the correct format.<\/p>","examples":[{"caption":"","code":"$policy = $builder->result();"}],"resources":[],"params":[],"exceptions":[],"returns":[{"types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"description":"<p>An array of policy data<\/p>"}]}]}